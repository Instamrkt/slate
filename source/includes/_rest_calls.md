# REST Calls

<aside class="notice">
Every rest call (except for signup and login) requires a server generated xsrf token. This (encrypted) token is generated by the server and saved on the client as soon as the user hits the first site / screen.
</aside>

<aside class="notice">
All request that require personal information require a userId parameter which is checked against a secure cookie.
</aside>

Passing parameters happens as follows:

1. GET Request - add a parameter to the query string.
2. POST Request - add a field to the post request.

Response outcomes and sent response codes:

Response | Code
--------- | -------
SUCCESS | 200
UNAUTHORIZED | 401
AUTH_REQUIRED | 403
ERROR | 500

## Login

> Sample request object:

```javascript
var $       = require('jquery');
$.post('/r/login', {
  'username': username,
  'password': password
  'next': ''
});
```

This is used to sign a user in.

### URL
`/r/login/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
username | Login of the user attempting to sign in.
password | Password of the user attempting to sign in.
next | The page where user is supposed to be redirected after login. Will be appended to the generated redirect url. Optional.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | Username of the signed in user (= passed loginname). Sent only on **successful** request.
id | null | Id of the signed in user. Necessary for Websocket API connection. Sent only on **successful** request.
redirect_url | /i/play | Redirect url for a signedin user (presumably for an endpoint requiring authentication). Can be used only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.


## Oauthlogin

> Sample request object:

```javascript
var $       = require('jquery');
$.post('/r/login/oauth/', {
  'oauthId': oauth_id,
  'oauthToken': oauthToken,
  'oauthEmail': oauthEmail,
  'oauthProvider': oauthProvider
});
```

This is used to sign a user in.

### URL
`/r/login/oauth/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
oauthId | Oauth id.
oauthToken | Oauth token.
oauthEmail | Oauth email (which the user will be registered with).
oauthProvider | Oauth provider (facebook, google etc.).
next | The page where user is supposed to be redirected after login. Will be appended to the generated redirect url. Optional.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | Username of the signed in user. Sent only on **successful** request.
id | null | Id of the signed in user. Necessary for Websocket API connection. Sent only on **successful** request.
redirect_url | /i/play | Redirect url for a signedin user (presumably for an endpoint requiring authentication). Can be used only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.

## Signup

> Sample request object:

```javascript
var $ = require('jquery');
$.post('/r/signup', {
  'username': username,
  'email': email,
  'password': password
});
```

This is used to sign a user in.

### URL
`/r/signup/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
username | Selected username to be validated an assigned in case of successful signup.
password | Selected password of the user attempting to sign up.
email | The email used to sign up (validated against our database, must be unique). All external communication will be directed to this email.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | Username of the signed up user. Sent only on **successful** request.
user_id | null | Id of the signed up user. Necessary for Websocket API connection. Sent only on **successful** request.
redirect_url | /i/play | Redirect url for a signedin user (presumably for an endpoint requiring authentication). Can be used only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.

## Get Username

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.get('/r/username', {
  headers: {
    'X-XSRFToken': _xsrf
  },
  'userId': userId
});
```

This is used to retrieve a username of a signed in user.

### URL
`/r/username/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
userId | userId for which username is to be retrieved.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | New username of the requesting user (= passed usernameNew). Sent only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.


## Set Username

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/username', {
	'_xsrf': _xsrf,
  'usernameNew': username,
  'password': password,
  'userId': userId
});
```

This is used to update a username of a signed in user. Password needs to be passed for confirmation.

### URL
`/r/username/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
usernameNew | New Username sign in.
password | Password of the user attempting to change the login (his id derived from the secure im_user cookie attached).
userId | User's id for which password is to be updated.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | New username of the requesting user (= passed usernameNew). Sent only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.

## Password recovery

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

 $.get('/r/password/recover/', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'username': usernameOrEmail
})
}));
```

This is used to request password recovery. It results in sending out an email with a url in which you can provide a new password (with a recovery code hidden in it).

### URL
`/r/password/recover/`

### Request type

`GER`

### Request Parameters

Parameter | Description
--------- | -------
username | Username or email of the user for whom password recovery is requested.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
msg | null | Error message. Sent only on **unsuccessful** request.

## Password update (from recovery)


> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/password/update/from_recovery', {
  '_xsrf': _xsrf,
  'password1': password1,
  'password2': password2,
  'recoveryCode': recoveryCode,
  'email': email
}));
```

This is used to update password from recovery. Requires the generated and emailed recovery code and an email it was emailed to, since the cookie might not be set in this case (e.g. you are on the new machine and forgot a password).

### URL
`/r/password/update/from_recovery/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
password1 | New password.
password2 | New password confirmation.
recoveryCode | The recovery code generated and included in the emailed url.
email | The email to which the code generated code was sent (the email is also included in the emailed url).

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
msg | null | Error message. Sent only on **unsuccessful** request.

## Password update (general)

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/password/update/', {
  '_xsrf': _xsrf,
  'passwordOld': passwordOld,
  'passwordNew1': passwordNew1,
  'passwordNew2': passwordNew2,
  'userId': userId
}));
```

This is used to update password from a form on the site / app screen.

### URL
`/r/password/update/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
passwordNew1 | New password.
passwordNew2 | New password confirmation.
passwordOld | Old password to prove action is intentional (and not performed by someone else when actual users leaves an open form).
userId | Id of the user whose the password is to be updated.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
msg | null | Error message. Sent only on **unsuccessful** request.

## Games history

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/games/history/', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'userId': userId
})
```

This is used to request a user's game history (all the games he has predicted in).

### URL
`/r/games/history/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
userId | Id of the user whose game history is to be retrieved.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
game_history | [] | A list of objects representing games. Each object contains the following fields: id, name, type, open_at, close_at.

## Games upcoming

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/games/upcoming/', {
  headers: {
      'X-XSRFToken': _xsrf
  }
})
```

This is used to request upcoming games.

### URL
`/r/games/upcoming/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
- | -

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
upcoming_games | [] | A list of objects representing games. Each object contains the following fields: id, source_id (for the source hosting the game), currency, live_start_at, game_type_id.

## Statistics

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/statistics/', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'userId': userId
})
```

This is used to request user's personal statistics.

### URL
`/r/statistics/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
userId | Id of the user whose statistics are to be retrieved.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
statistics | {} | A dictionary containing selected user's personal statistics. **key** - statistic name, **value** - statistic value. Sent statistics: total_bets_won, total_bets_lost, average_number_of_bets_per_game, average_points_won_per_game, average_reaction_time.

## Friends

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/friends/', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'userId': userId
})
```

This is used to request user's personal statistics.

### URL
`/r/friends/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
userId | Id of the user whose friends are to be retrieved.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
friends | {} | A dictionary containing selected user's personal statistics. **key** - friend's user id, **value** - friend's name.


## Leaderboard (global)


> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/leaderboard/global/', {
  headers: {
      'X-XSRFToken': _xsrf
  }
})
```

This is used to request a global leaderboard.

### URL
`/r/leaderboard/global/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
- | -

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
leaderboard | [] | A list of objects. Every object has the form: **key** - points, **value** - user's name.



## Leaderboard (personal)


> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')

$.get('/r/leaderboard/personal/', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'userId': userId
})
```

This is used to request a personal leaderboard.

### URL
`/r/leaderboard/personal/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
userId | User id for which personal leaderboard is requested.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
leaderboard | [] | A list of objects. Every object has the form: **key** - points, **value** - user's name.