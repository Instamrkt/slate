# REST Calls

<aside class="notice">
Every rest call (except for signup and login) requires a server generated xsrf token. This (encrypted) token is generated by the server and saved on the client as soon as the user hits the first site / screen.
</aside>

<aside class="notice">
A lot of requests also require you to include the 'im_user' secure cookie.
</aside>

Passing parameters happens as follows:

1. GET Request - add a parameter to the query string.
2. POST Request - add a field to the post request.

Response outcomes and sent response codes:

Response | Code
--------- | -------
SUCCESS | 200
UNAUTHORIZED | 401
AUTH_REQUIRED | 403
ERROR | 500

## Login

> Sample request object:

```javascript
var $       = require('jquery');
$.post('/r/login', {
  'username': username,
  'email': email,
  'password': password
});
```

This is used to sign a user in.

### URL
`/r/login/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
loginname | Login of the user attempting to sign in.
password | Password of the user attempting to sign in.
next | The page where user is supposed to be redirected after login. Will be appended to the generated redirect url. Optional.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | Username of the signed in user (= passed loginname). Sent only on **successful** request.
id | null | Id of the signed in user. Necessary for Websocket API connection. Sent only on **successful** request.
redirect_url | /i/play | Redirect url for a signedin user (presumably for an endpoint requiring authentication). Can be used only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.


## Oauthlogin
## Signup

> Sample request object:

```javascript
var $ = require('jquery');
$.post('/r/signup', {
  'username': username,
  'email': email,
  'password': password
});
```

This is used to sign a user in.

### URL
`/r/signup/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
username | Selected username to be validated an assigned in case of successful signup.
password | Selected password of the user attempting to sign up.
email | The email used to sign up (validated against our database, must be unique). All external communication will be directed to this email.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | Username of the signed up user. Sent only on **successful** request.
user_id | null | Id of the signed up user. Necessary for Websocket API connection. Sent only on **successful** request.
redirect_url | /i/play | Redirect url for a signedin user (presumably for an endpoint requiring authentication). Can be used only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.

## Session key
> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf')
$.get('/r/key', {
  headers: {
      'X-XSRFToken': _xsrf
  },
  'user_id': user_id,
})
```

This is used to request a user's session key. The key is necessary to connect with the Websocket API server.

### URL
`/r/key/`

### Request type

`GET`

### Request Parameters

Parameter | Description
--------- | -------
user_id | Id of the signed in user for which the key is requested.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
key | null | The requested key for the user. Sent only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.


## Username update

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/username', {
	'_xsrf': _xsrf,
  'username': username,
  'email': email,
  'password': password
});
```

This is used to update a username of a signed in user. Password needs to be passed for confirmation.

### URL
`/r/username/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
newUsername | New Username sign in.
password | Password of the user attempting to change the login (his id derived from the secure im_user cookie attached).

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
username | null | New username of the requesting user (= passed newUsername). Sent only on **successful** request.
msg | null | Error message. Sent only on **unsuccessful** request.

## Password recovery

> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/update_password', {
  '_xsrf': _xsrf,
  'pass1': pass1,
  'pass2': pass2,
  'recoveryCode': recoveryCode,
  'email': email
}));
```

This is used to request password recovery. It results in sending out an email with a url in which you can provide a new password (with a recovery code hidden in it).

### URL
`/r/update_password/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
user | Username for which password recovery is requested.

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
msg | null | Error message. Sent only on **unsuccessful** request.

## Password update (from recovery)


> Sample request object:

```javascript
var $       = require('jquery');
var cookies = require('cookie-getter');
var _xsrf   = cookies('_xsrf');

$.post('/r/update_password', {
  '_xsrf': _xsrf,
  'pass1': pass1,
  'pass2': pass2,
  'recoveryCode': recoveryCode,
  'email': email
}));
```

This is used to update password from recovery. Requires the generated and emailed recovery code and an email it was emailed to, since the cookie might not be set in this case (e.g. you are on the new machine and forgot a password).

### URL
`/r/update_password/`

### Request type

`POST`

### Request Parameters

Parameter | Description
--------- | -------
pass1 | New password.
pass2 | New password confirmation.
recoveryCode | The recovery code generated and included in the emailed url.
email | The email to which the code generated code was sent (the email is also included in the emailed url).

### Response Parameters

Parameter | Default | Description
--------- | ------- | -----------
msg | null | Error message. Sent only on **unsuccessful** request.

## Password update (general)

## Games history
## Games upcoming

## Statistics
## Friends
## Leaderboard


